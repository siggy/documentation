<!DOCTYPE html>
<html lang="en-us">

<head>
  

<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>

<link rel="shortcut icon" type="image/png" href="/favicon.ico"/>


<link rel='stylesheet' href='https://documentation.sig.gy/style.min.7e0da58aeb22158e014a1cfd6380315680c7e74911da517d5304d94559cf0f32.css'>


<script src='https://documentation.sig.gy/main.min.db37c27117ff8400e5e30549f6806d2bc825668b596d81316c6148417f59bc72.js' async></script>


  <title>升级到新版本 - Mastodon documentation</title>

  <meta property="og:type" content="article">
  <meta property="og:url" content="https://documentation.sig.gy/zh-cn/admin/upgrading/">

  

  <meta name="twitter:title" content="升级到新版本">
  <meta name="twitter:site" content="@joinmastodon">

  <link rel="canonical" href="https://documentation.sig.gy/zh-cn/admin/upgrading/">
</head>

<body>
  <div class="container sidebar-layout">
    <nav class="sidebar"><a class="brand" href="/">
  <img class="link-logo" src="/brand.svg" alt="Mastodon" />
</a>

<ul>
  
  
    <li>
      
        <a href="/zh-cn/" class="">什么是Mastodon？</a>
      

      
    </li>
  
    <li>
      
        <span class="sub-title">使用Mastodon</span>
      

      
        <ul class="sub-menu">
          
            <li>
              <a href="/zh-cn/user/signup/" class="">创建一个帐户</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/user/profile/" class="">设置个人资料</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/user/posting/" class="">发布嘟文</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/user/network/" class="">使用社交功能</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/user/moderating/" class="">处理不想要的内容</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/user/discoverability/" class="">推广自己和他人</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/user/preferences/" class="">设置你的首选项</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/user/contacts/" class="">更多设置</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/user/external/" class="">站外使用Mastodon</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/user/moving/" class="">迁移或删除帐户</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/user/run-your-own/" class="">运行自己的服务器</a>

              
            </li>
          
        </ul>
      
    </li>
  
    <li>
      
        <span class="sub-title">运营Mastodon</span>
      

      
        <ul class="sub-menu">
          
            <li>
              <a href="/zh-cn/admin/prerequisites/" class="">准备你的机器</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/admin/install/" class="">从源中安装</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/admin/config/" class="">设置你的环境</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/admin/optional/" class="">安装可选特色功能</a>

              
                <ul class="sub-menu">
                  
                    <li>
                      <a href="/zh-cn/admin/optional/elasticsearch/" class="">全文搜索</a>
                    </li>
                  
                    <li>
                      <a href="/zh-cn/admin/optional/tor/" class="">匿名服务</a>
                    </li>
                  
                    <li>
                      <a href="/zh-cn/admin/optional/sso/" class="">单点登录（SSO）</a>
                    </li>
                  
                </ul>
              
            </li>
          
            <li>
              <a href="/zh-cn/admin/setup/" class="">配置你的新实例</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/admin/tootctl/" class="">使用管理命令行</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/admin/upgrading/" class="active">升级到新版本</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/admin/backups/" class="">备份你的服务器</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/admin/migrating/" class="">迁移到新机器</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/admin/scaling/" class="">伸缩你的服务器</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/admin/moderation/" class="">运营操作</a>

              
            </li>
          
            <li>
              <a href="/zh-cn/admin/troubleshooting/" class="">故障分析</a>

              
            </li>
          
        </ul>
      
    </li>
  
    <li>
      
        <span class="sub-title">开发Mastodon应用</span>
      

      
    </li>
  
    <li>
      
        <span class="sub-title">向Mastodon项目做贡献</span>
      

      
    </li>
  
    <li>
      
        <span class="sub-title">遵循的标准</span>
      

      
    </li>
  
    <li>
      
        <span class="sub-title">REST API</span>
      

      
    </li>
  
    <li>
      
        <span class="sub-title">API 方法</span>
      

      
    </li>
  
    <li>
      
        <span class="sub-title">API 实体</span>
      

      
    </li>
  
</ul>
</nav>
    <main>
  <h1>升级到新版本</h1>

  
  <aside>
    <nav id="TableOfContents"></nav>
  </aside>
  <div class="e-content">
    <div class="hint hint-info">
  <div class="hint-icon"><i class="fa fa-info-circle"></i></div>

  当一个新的Mastodon版本释出后，它将出现在<a href="https://github.com/tootsuite/mastodon/releases">GitHub releases页面</a>。请注意：运行来自<code>master</code>分支的未释出代码，虽然可以进行，但不推荐这样做。
</div>

<p>Mastodon版本与git tags一致。在尝试升级之前，请至<a href="https://github.com/tootsuite/mastodon/releases">GitHub releases页面</a>查找所需版本。该页面包含了一个<strong>更新日专</strong>，其中描述你需要了解的所有差异，以及<strong>特定的升级指令</strong>。</p>
<p>开始之前，切换至<code>mastodon</code>用户：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">su - mastodon
</code></pre></div><p>并转至Mastodon根目录：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8be9fd;font-style:italic">cd</span> /home/mastodon/live
</code></pre></div><p>下载相应版本代码，这里假定版本为<code>v3.1.2</code>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git fetch --tags
git checkout v3.1.2
</code></pre></div><p>现在，执行GitHub版本发布说明中的升级指令。因为不同的版本有不同的指令，所以本页面将不包括任何指令。</p>
<div class="hint hint-info">
  <div class="hint-icon"><i class="fa fa-info-circle"></i></div>

  从旧版本升级时，你可以安全的跳过中间版本。你无需单独检出他们。然而，你确实需要追踪每一个版本的升级指令。大多数指令都是重叠的，你只需要确保每条至少执行一次即可。
</div>

<p>当你执行完版本发布说明中的指令后，切换回root用户：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8be9fd;font-style:italic">exit</span>
</code></pre></div><p>重启<strong>后台worker</strong>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl restart mastodon-sidekiq
</code></pre></div><p>并重载<strong>web进程</strong>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl reload mastodon-web
</code></pre></div><div class="hint hint-info">
  <div class="hint-icon"><i class="fa fa-info-circle"></i></div>

  <code>reload</code>操作是零下线时间的重启（restart），也被称为“分阶段重启（phased restart）”。因此，Mastodon升级通常不需要为计划下线而提前发布公告。罕见情况下，你可以改用<code>restart</code>操作，但你的用户将感到（短暂的）服务中断。
</div>

<p>罕见情况下，<strong>streaming API</strong> 服务也会被更新并需要重启：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl restart mastodon-streaming
</code></pre></div><div class="hint hint-danger">
  <div class="hint-icon"><i class="fa fa-exclamation-triangle"></i></div>

  更新streaming API服务非常罕见，在大多数版本中，<em>不</em>需要重启它。重启streaming API将导致服务器负载增加，因为断线的用户会尝试重连或改用REST API轮询。因此请尽量避免重启streaming API服务
</div>

<div class="hint hint-success">
  <div class="hint-icon"><i class="fa fa-check-circle"></i></div>

  <strong>就这样！</strong> 您现在正在运行新版本的Mastodon。
</div>

<figure>
    <p>
        <strong>翻译状态：</strong>
        本文是英文页面 <a href="/admin/upgrading/">Upgrading to a new release</a> 的翻译，最后翻译时间：2020-05-04，点击<a href="https://github.com/tootsuite/documentation/compare/ad1ef20f171c9f61439f32168987b0b4f9abd74b...master">这里</a>可以查看翻译后页面的改动。
    </p>
</figure>



    <p style="color: #687590;">
      最后更新于 May 21, 2020 · <a href='https://github.com/tootsuite/documentation/tree/master/content/zh-cn/admin/upgrading.md' style="color: #687590;">改进此页面</a>

      
        <br />

        也可在此找到：

        
          <a href="https://documentation.sig.gy/admin/upgrading/" style="color: #687590;" hreflang="en">English</a>
        
      
    </p>

  </div>
</main>
  </div>

  <footer class="footer container">
  <div class="sponsorship">
    <div class="container">
      <h2>
        Sponsored by
      </h2>

      <div class="logo-grid">
        <div>
          <a href="https://www.dotcom-monitor.com/es/">
            <img src="/assets/sponsors/dotcom-monitor-logo.png" alt="Dotcom-Monitor" />
          </a>

          <a href="https://www.loadview-testing.com/products/jmeter-load-testing/">
            <img src="/assets/sponsors/LoadView-logo.png" alt="LoadView" />
          </a>

          <a href="http://www.stevetures.com/">
            <img src="/assets/sponsors/stephen-tures.jpg" alt="Stephen Tures" />
          </a>

          <a href="https://swayable.com">
            <img src="/assets/sponsors/swayable.jpeg" alt="Swayable" />
          </a>
        </div>
      </div>
    </div>
  </div>

  <p class="legal legal--right">
    <a href='https://joinmastodon.org'>加入Mastodon</a> · <a href='https://blog.joinmastodon.org'>博客</a> · <a href='https://mastodon.social/@Mastodon' target='_blank'><i class='fab fa-mastodon'></i></a> · <a href='https://twitter.com/joinmastodon' rel='nofollow' target='_blank'><i class='fab fa-twitter'></i></a>
  </p>

  <p class="legal"><a href='https://github.com/tootsuite/documentation/tree/master/content/zh-cn/admin/upgrading.md'>查看源代码</a> · <a href='https://creativecommons.org/licenses/by-sa/4.0/'>CC BY-SA 4.0</a> · <a href='https://joinmastodon.org/imprint'>版权信息</a></p>
</footer>

</body>

</html>
